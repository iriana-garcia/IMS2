<ui:composition template="/secure/default.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:sec="http://www.springframework.org/security/tags">



	<ui:define name="body">


		<script>
		

			
		function selectRowByIndex(select, row) {			
			if( select.checked == true){
					$("tr[data-ri|="+row+"]").each(function() {				
						$(this).addClass('ui-state-highlight');	
						$(this).find('div.chcAccess').each(function(){
								$(this).find(':checkbox').each(function() {	
									$(this).prop("checked", true);							
								});		
								$(this).find('div.ui-chkbox-box').each(function() {														
									$(this).addClass('ui-state-active');
									$(this).children('span').attr('class', '');
									$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
										
							 });
						});	
						
					});	
			}else{
				
				$("tr[data-ri|="+row+"]").each(function() {				
					$(this).removeClass('ui-state-highlight');	
					$(this).removeClass('rowSelected');	
					
						$(this).find(':checkbox').each(function() {	
								$(this).prop("checked", false);							
							});		
							$(this).find('div.ui-chkbox-box').each(function() {														
								 $(this).removeClass('ui-state-active');
								 $(this).children('span').attr('class', '');
						         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');								
									
						 });
				
					
				});	
				
			}
			
		}
		
		
		function selectAllByClass(select) {
			
			if( select.checked == true){
								
				$('div.ui-chkbox-box').each(function() {														
						$(this).addClass('ui-state-active');
						$(this).children('span').attr('class', '');
						$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
							
				 });
				
				$(':checkbox').prop("checked", true);
				
				$("tr[role|=row]").each(function() {				
					$(this).addClass('ui-state-highlight');											
				});	
				
				
						
			}else{
								
				$('div.ui-chkbox-box').each(function() {						
						 $(this).removeClass('ui-state-active');
						 $(this).children('span').attr('class', '');
				         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');						
				    });	
				
				$(':checkbox').prop("checked", false);
				
					$("tr[role|=row]").each(function() {				
						$(this).removeClass('ui-state-highlight');		
						$(this).removeClass('rowSelected');	
					});	
				
			}
		}  
		

		function selectAccess(select) {
			if( select.checked == true){
								
						$("tr[role|=row]").each(function() {				
							$(this).addClass('ui-state-highlight');											
						});	
						$('div.chcAccess').each(function() {	
							$(this).find(':checkbox').prop( "checked", true );	
							$(this).find('div.ui-chkbox-box').each(function() {														
								$(this).addClass('ui-state-active');
								$(this).children('span').attr('class', '');
								$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
									
							 });
						});	
					}else{
							
							$("tr[role|=row]").each(function() {				
								$(this).removeClass('ui-state-highlight');	
								$(this).removeClass('rowSelected');	
							});	
										
							$('div.chcAccess').find(':checkbox').each(function() {	
								$(this).prop( "checked", false );				
							});	
							
							$('div.chcAccess').find('div.ui-chkbox-box').each(function() {					
								 $(this).removeClass('ui-state-active');
								 $(this).children('span').attr('class', '');
						         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');
							});	
							
			}
						
	}
		
		
		
		function selectAdd(select) {
			if( select.checked == true){
								
						$("tr[role|=row]").each(function() {				
							$(this).addClass('ui-state-highlight');											
						});	
						$('div.chcAccess').each(function() {	
							$(this).find(':checkbox').prop( "checked", true );	
							$(this).find('div.ui-chkbox-box').each(function() {														
								$(this).addClass('ui-state-active');
								$(this).children('span').attr('class', '');
								$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
									
							 });
						});	
						
						$('div.chcAdd').each(function() {	
							$(this).find(':checkbox').prop( "checked", true );	
							$(this).find('div.ui-chkbox-box').each(function() {					
								$(this).addClass('ui-state-active');
								$(this).children('span').attr('class', '');
								$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');
							});	
						});	
						
						
			}else{
				
				$('div.chcAdd').find(':checkbox').each(function() {	
					$(this).prop( "checked", false );				
				});	
				
				$('div.chcAdd').find('div.ui-chkbox-box').each(function() {					
					 $(this).removeClass('ui-state-active');
					 $(this).children('span').attr('class', '');
			         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');
				});	
			}
			
		}
		
		function selectModify(select) {
			if( select.checked == true){
						
				
							$("tr[role|=row]").each(function() {				
								$(this).addClass('ui-state-highlight');											
							});	
							$('div.chcAccess').each(function() {	
								$(this).find(':checkbox').prop( "checked", true );	
								$(this).find('div.ui-chkbox-box').each(function() {														
									$(this).addClass('ui-state-active');
									$(this).children('span').attr('class', '');
									$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
										
								 });
							});	
				
						$('div.chcModify').each(function() {	
							$(this).find(':checkbox').prop( "checked", true );	
							$(this).find('div.ui-chkbox-box').each(function() {														
								$(this).addClass('ui-state-active');
								$(this).children('span').attr('class', '');
								$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
									
							 });			
						});	
						
						
			}else{
				
				$('div.chcModify').find(':checkbox').each(function() {	
					$(this).prop( "checked", false );				
				});	
				
				$('div.chcModify').find('div.ui-chkbox-box').each(function() {					
					 $(this).removeClass('ui-state-active');
					 $(this).children('span').attr('class', '');
			         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');
				});	
			}
			
			 
		}
		
		
		function selectState(select) {
			if( select.checked == true){
						
							$("tr[role|=row]").each(function() {				
								$(this).addClass('ui-state-highlight');											
							});	
							$('div.chcAccess').each(function() {	
								$(this).find(':checkbox').prop( "checked", true );	
								$(this).find('div.ui-chkbox-box').each(function() {														
									$(this).addClass('ui-state-active');
									$(this).children('span').attr('class', '');
									$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
										
								 });
							});	
				
				
						$('div.chcState').each(function() {	
							$(this).find(':checkbox').prop( "checked", true );	
							$(this).find('div.ui-chkbox-box').each(function() {														
								$(this).addClass('ui-state-active');
								$(this).children('span').attr('class', '');
								$(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-check');						
									
							 });
						});	
			}else{
				
				$('div.chcState').find(':checkbox').each(function() {	
					$(this).prop( "checked", false );				
				});	
				
				$('div.chcState').find('div.ui-chkbox-box').each(function() {					
					 $(this).removeClass('ui-state-active');
					 $(this).children('span').attr('class', '');
			         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');
				});	
			}
			
			 
		}
		
		
		function selectRow() {	
			$("tr[aria-selected|=false]").each(function() {					
						$(this).find('div.ui-chkbox-box').each(function() {					
							 $(this).removeClass('ui-state-active');
							 $(this).children('span').attr('class', '');
					         $(this).children('span').addClass('ui-chkbox-icon ui-icon ui-c ui-icon-blank');
					         $(this).find(':checkbox').each(function() {	
									$(this).prop("checked", false );				
								});	
						});	
												
			});	
			
		}
			
		
		
  
        </script>

		<sec:authorize
			access="hasAnyRole('SUPER','M','A')">

			<h:form id="form" onkeypress="if( event.keyCode == 13){if(document.activeElement.type == 'submit') return true; else return false;}">
				<p:toolbar>
					<f:facet name="left">
						<h:outputText
							value="#{(rolController.edit)? msg.edit : msg.add} #{msg.rol}" />
					</f:facet>

					<f:facet name="right">
						<p:commandButton value="#{msg.save}" icon="ui-icon-disk"
							action="#{rolController.update}" styleClass="buttonBarra"
							validateClient="true" rendered="#{rolController.edit}">
							<p:confirm icon="ui-icon-alert" />
						</p:commandButton>
						<p:commandButton value="#{msg.save}" icon="ui-icon-disk"
							action="#{rolController.update}" styleClass="buttonBarra"
							validateClient="true"
							rendered="#{rolController.edit ? false : true}">
						</p:commandButton>

						<p:spacer width="10" />

						<p:commandButton value="#{msg.cancel}" icon="ui-icon-close"
							action="rol" styleClass="buttonBarra" immediate="true"
							validateClient="false" />
					</f:facet>
				</p:toolbar>


				<h:panelGrid styleClass="panel" columns="1">


					<h:panelGrid border="0" columns="1">
						<p:messages id="messages" showDetail="false" autoUpdate="true"
							globalOnly="false" />
					</h:panelGrid>


					<h:panelGrid columns="3">

						<p:outputLabel value="#{msg.name}" for="txtName" />
						<p:inputText value="#{rolController.entity.name}" required="true"
							id="txtName" maxlength="50" size="50"  onblur="this.value = this.value.trim()">
							<p:clientValidator event="blur"/>
						</p:inputText>
						<p:message for="txtName" display="icon" />

						<p:outputLabel value="#{msg.state}" for="txtState"
							rendered="#{rolController.edit}" />
						<p:selectOneRadio id="txtState" rendered="#{rolController.edit}"
							value="#{rolController.entity.state}"
							disabled="#{rolController.entity.userAssociate}">
							<f:selectItem itemLabel="#{msg.deactive}" itemValue="false" />
							<f:selectItem itemLabel="#{msg.active}" itemValue="true" />
						</p:selectOneRadio>
						<p:message for="txtState" display="icon"
							rendered="#{rolController.edit}" />
					</h:panelGrid>


					<h:panelGrid columnClasses="righted" width="100%">

						<p:selectBooleanCheckbox itemLabel="Check/Uncheck All"
							widgetVar="checkAllaaa" onchange="selectAllByClass(this);">
						</p:selectBooleanCheckbox>


					</h:panelGrid>

					<h:panelGrid>

						<p:dataTable var="per" value="#{rolController.entity.permissions}"
							binding="#{rolController.dataTablePerm}"
							rowKey="#{per.permission.id}" widgetVar="wgdPermis" id="tblPerm"
							rowIndexVar="rowIndex" selectionMode="single"  rowStyleClass="#{per.accessAdd == true ? 'rowSelected' : null}">

							<p:column headerText="#{msg.name}">
								<h:outputText value="#{per.permission.name}" />
							</p:column>
							<p:column headerText="#{msg.descripcion}">
								<h:outputText value="#{per.permission.descripcion}" />
							</p:column>

							<p:column headerText="#{msg.access}" width="40"
								style="text-align: center;">
								<f:facet name="header">
									<h:outputText value="#{msg.access}" />
									<p:selectBooleanCheckbox onchange="selectAccess(this)">
									</p:selectBooleanCheckbox>
								</f:facet>
								<div class="chcAccess">
									<p:selectBooleanCheckbox value="#{per.accessAdd}"
										styleClass="serviceStatusStyleClass"
										onchange="selectRowByIndex(this,#{rowIndex})" />
								</div>
							</p:column>



							<p:column headerText="#{msg.add}" width="40"
								style="text-align: center;" >
								<f:facet name="header">
									<h:outputText value="#{msg.add}" />
									<p:selectBooleanCheckbox onchange="selectAdd(this)">
									</p:selectBooleanCheckbox>
								</f:facet>
								<div class="chcAdd">
									<p:selectBooleanCheckbox value="#{per.add}"
										styleClass="serviceStatusStyleClass"
										onchange="selectRowByIndex(this,#{rowIndex})" />
								</div>
							</p:column>

							<p:column headerText="#{msg.modify}" width="40"
								style="text-align: center;">
								<f:facet name="header">
									<h:outputText value="#{msg.modify}" />
									<p:selectBooleanCheckbox onchange="selectModify(this)">
									</p:selectBooleanCheckbox>
								</f:facet>
								<div class="chcModify">
									<p:selectBooleanCheckbox value="#{per.modify}"
										onchange="selectRowByIndex(this,#{rowIndex})" />
								</div>
							</p:column>

							<p:column headerText="#{msg.change_state}" width="40"
								style="text-align: center;">
								<f:facet name="header">

									<h:outputText value="#{msg.state}" />
									<p:selectBooleanCheckbox onchange="selectState(this)">
									</p:selectBooleanCheckbox>

								</f:facet>
								<div class="chcState">
									<p:selectBooleanCheckbox value="#{per.changeState}"
										styleClass="mio" onchange="selectRowByIndex(this,#{rowIndex})" />
								</div>
							</p:column>

							<p:column headerText="#{msg.delete}" width="40"
								style="text-align: center;" rendered="false">
								<p:selectBooleanCheckbox value="#{per.delete}" />
							</p:column>

						</p:dataTable>

					</h:panelGrid>
				</h:panelGrid>



				<ui:include src="/secure/confirmation_modify.xhtml"></ui:include>
			</h:form>
		</sec:authorize>
	</ui:define>
</ui:composition>